name: Build and Release Persian TTS Package

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create tarball of voice data
        run: |
          echo "ğŸ“¦ Creating tarball of Persian voice data..."
          # Ø§Ú¯Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù†Ø¯ØŒ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ ÙØ´Ø±Ø¯Ù‡ Ú©Ù†
          if [ -d "espeak-ng-data" ] || [ -d "voices" ]; then
            tar -czf espeak-persian-data.tar.gz espeak-ng-data/ voices/ 2>/dev/null && echo "âœ… Tarball created from data folders"
          else
            # Ø§Ú¯Ø± Ø³Ø§Ø®ØªØ§Ø± Ù…ØªÙØ§ÙˆØª Ø§Ø³ØªØŒ Ú©Ù„ Ù…Ø®Ø²Ù† Ø±Ø§ ÙØ´Ø±Ø¯Ù‡ Ú©Ù† (Ø¨Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ† Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø¬Ø²Ø¦ÛŒ)
            tar -czf espeak-persian-data.tar.gz --exclude=.git --exclude=.github . || echo "âš ï¸ Tarball created with warnings"
          fi
          ls -lh espeak-persian-data.tar.gz || echo "âŒ Tarball not created"

      - name: Upload artifact (for debugging)
        uses: actions/upload-artifact@v4
        with:
          name: espeak-persian-data
          path: espeak-persian-data.tar.gz

      - name: Create Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          name: ğŸ“¢ Ø¨Ø³ØªÙ‡ ØµÙˆØªÛŒ ÙØ§Ø±Ø³ÛŒ ${{ github.ref_name }}
          body_path: release_notes.md
          files: espeak-persian-data.tar.gz
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
